From 1d310fd2d02a53d1a06081b8585a964d93553456 Mon Sep 17 00:00:00 2001
From: Francisco Boni <boboniboni@gmail.com>
Date: Sun, 19 Dec 2021 03:38:58 -0300
Subject: [PATCH 2/2] STATIC build

---
 src/CMakeLists.txt         | 22 ++++++++++++++++------
 src/profile/CMakeLists.txt |  1 +
 src/session/CMakeLists.txt |  1 +
 3 files changed, 18 insertions(+), 6 deletions(-)

diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index dd2fd2b6..bdc4a29f 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -227,9 +227,19 @@ ki18n_wrap_ui(konsoleprivate_SRCS
 # add the resource files for the ui files
 qt5_add_resources( konsoleprivate_SRCS ../desktop/konsole.qrc)
 
-add_library(konsoleprivate ${konsoleprivate_SRCS})
+add_library(konsoleprivate STATIC ${konsoleprivate_SRCS})
 generate_export_header(konsoleprivate BASE_NAME konsoleprivate)
 
+#set_property(TARGET konsoleprivate_core PROPERTY VISIBILITY_INLINES_HIDDEN OFF)
+#set_property(TARGET konsolecolorscheme PROPERTY VISIBILITY_INLINES_HIDDEN OFF)
+#set_property(TARGET keyboardtranslator PROPERTY VISIBILITY_INLINES_HIDDEN OFF)
+#set_property(TARGET konsolehelpers PROPERTY VISIBILITY_INLINES_HIDDEN OFF)
+#set_property(TARGET konsolesession PROPERTY VISIBILITY_INLINES_HIDDEN OFF)
+#set_property(TARGET konsoleprofile PROPERTY VISIBILITY_INLINES_HIDDEN OFF)
+#set_property(TARGET konsolecharacters PROPERTY VISIBILITY_INLINES_HIDDEN OFF)
+#set_property(TARGET konsoledecoders PROPERTY VISIBILITY_INLINES_HIDDEN OFF)
+#set_property(TARGET konsoleprivate PROPERTY VISIBILITY_INLINES_HIDDEN OFF)
+
 target_link_libraries(konsoleprivate
     PUBLIC
     konsoleprivate_core
@@ -243,12 +253,12 @@ target_link_libraries(konsoleprivate
     ${konsole_LIBS}
 )
 
-set_target_properties(konsoleprivate PROPERTIES
-    VERSION ${KONSOLEPRIVATE_VERSION}
-    SOVERSION ${KONSOLEPRIVATE_SOVERSION}
-)
+#set_target_properties(konsoleprivate PROPERTIES
+    #VERSION ${KONSOLEPRIVATE_VERSION}
+    #SOVERSION ${KONSOLEPRIVATE_SOVERSION}
+#)
 
-install(TARGETS konsoleprivate ${KDE_INSTALL_TARGETS_DEFAULT_ARGS} LIBRARY NAMELINK_SKIP)
+#install(TARGETS konsoleprivate ${KDE_INSTALL_TARGETS_DEFAULT_ARGS} LIBRARY NAMELINK_SKIP)
 
 add_library(konsoleapp SHARED Application.cpp
    MainWindow.cpp
diff --git a/src/profile/CMakeLists.txt b/src/profile/CMakeLists.txt
index 34fb583b..7dcffde5 100644
--- a/src/profile/CMakeLists.txt
+++ b/src/profile/CMakeLists.txt
@@ -17,6 +17,7 @@ target_include_directories(konsoleprofile PUBLIC ${CMAKE_CURRENT_BINARY_DIR})
 target_link_libraries(
     konsoleprofile
     ${konsole_LIBS}
+    konsoleprivate
     konsoleprivate_core
     konsolecolorscheme
     keyboardtranslator
diff --git a/src/session/CMakeLists.txt b/src/session/CMakeLists.txt
index e369da19..6d60f8e6 100644
--- a/src/session/CMakeLists.txt
+++ b/src/session/CMakeLists.txt
@@ -34,6 +34,7 @@ generate_export_header(konsolesession BASE_NAME konsolesession)
 target_include_directories(konsolesession PUBLIC ${CMAKE_CURRENT_BINARY_DIR})
 target_link_libraries(
     konsolesession
+    konsoleprivate
     ${konsole_LIBS}
     konsoleprofile  # TODO: Must be removed from here, Used only for ProfileCommandParser::parse in SessionManager::sessionProfileCommandReceived
 )
-- 
2.34.1

